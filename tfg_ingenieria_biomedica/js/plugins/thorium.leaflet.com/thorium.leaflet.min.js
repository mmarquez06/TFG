/*!
 * Open Street Map + Leaflet.js functions for Thorium  projects
 * Version 4.0 March, 2024
 * framework7 v8.x (https://framework7.io) MIT Licensed
 * Open Street Map (https://www.openstreetmap.org)
 * Leaflet: https://leafletjs.com - BSD 2-Clause "Simplified" License
 * Copyright 2018-2024 Thorium builder.
*/
var openStreetMapPlugin={name:"Thorium Builder OpenStreetMap - Leaflet.js Plugin",bundleid:"com.thoriumbuilder.leaflet",version:"4.0.0",infoWindowHTML:'<div class="iw-container" >   <i class="fa f7-icons btncloseinfowindow">xmark_circle</i> \t<div class="row">\t\t<div class="imgbloc xsmall-30 small-20 medium-20 large-10 xlarge-10 col-3 ">\t\t\t<img class="img-zoom" src="{img}" alt="{name}"  title="{name}<br>{subtitle}" >\t\t</div>\t\t<div class="xsmall-70 small-80 medium-80 large-90 xlarge-90 col-9">\t\t\t<div class="iw-title">{name}&nbsp;<span>{badge}</span></div>\t\t\t<div class="iw-subtitle">{subtitle}</div>\t\t\t<div class="iw-rate">{rating}</div>\t\t\t<div class="iw-subtitle">{address}</div>\t\t\t<div class="flexbox display-flex flex-row align-items-center pt-1" >\t\t\t\t<a id="osm_btn" data-tooltip="info" class="button button-round item-link button-fill tooltip-init" href="/{target}/?id={uid}{datablock}" data-transition="f7-cover-v"><i class="fa f7-icons active-state" >info_circle_fill</i></a>\t\t\t\t<a id="dir_btn_from" data-tooltip="direction from here" class="button button-round button-fill tooltip-init" onclick="window.open(\'https://www.google.com/maps/dir/?api=1&amp;destination={latitude},{longitude}\',\'_parent\');" ><i class="fa f7-icons active-state" >arrow_up_right_diamond_fill</i></a>\t\t\t\t<a id="dir_btn_to" data-tooltip="direction to here" class="button button-round button-fill tooltip-init" onclick="window.open(\'https://www.google.com/maps/dir/?api=1&amp;origin={latitude},{longitude}\',\'_parent\');" ><i class="fa f7-icons active-state" >arrow_uturn_left_circle_fill</i></a>\t\t\t</div>\t\t</div>\t</div></div">',popup:null,geolocString:"You are within {radius} meters from this point",getFirebaseData:function(e,t){if("undefined"==typeof firestoredb)return thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Firestore Database not defined"),void openStreetMapPlugin.showAlert("Firestore Database not defined");if(!firebase.auth().currentUser)return void thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] User not connected");var i=[],a=e.getAttribute("data-firebase-maxrows")||1e4;0==a&&(a=1e4);const r=e.getAttribute("data-filter-field"),o=e.getAttribute("data-filter-operator"),n=e.getAttribute("data-filter-value"),l=e.getAttribute("data-filter-field2"),d=e.getAttribute("data-filter-operator2"),u=e.getAttribute("data-filter-value2"),p=(e.getAttribute("data-template"),"true"==e.getAttribute("data-user-data")||!1);var s=e.getAttribute("data-collection")||null;if(!s)return thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Firebase Collection not set for OpenstreetMap API"),e.setAttribute("data-loaded",!1),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("firebaseMapLoadError",$(this),"Collection not Defined"),void openStreetMapPlugin.showAlert("Error getting documents, Collection not Defined");thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Get Firebase Data for OpenStreetMap [collection:"+s+"]");var m=firestoredb.collection(s);if("")try{m=m.where("parentuid","==","")}catch(t){return e.setAttribute("data-loaded",!1),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("firebaseMapLoadError",$(this),t.message),void openStreetMapPlugin.showAlert(t.message)}if(r){g="false"!=n&&("true"==n||n);try{m=m.where(r,o,g)}catch(t){return e.setAttribute("data-loaded",!1),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("firebaseMapLoadError",$(this),t.message),void openStreetMapPlugin.showAlert(t.message)}}if(l){var g;g="false"!=u&&("true"==u||u);try{m=m.where(l,d,g)}catch(t){return e.setAttribute("data-loaded",!1),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("firebaseMapLoadError",$(this),t.message),void openStreetMapPlugin.showAlert(t.message)}}if(1==p){var c=firebase.auth().currentUser;if(null!=c)try{m=m.where("createdby","==",c.uid)}catch(t){return e.setAttribute("data-loaded",!1),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("firebaseMapLoadError",$(this),t.message),void openStreetMapPlugin.showAlert(t.message)}}if(a&&a>0)try{m=m.limit(parseInt(a))}catch(t){return thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Firestore Error: "+t.message),e.setAttribute("data-loaded",!1),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("firebaseMapLoadError",$(this),t.message),void openStreetMapPlugin.showAlert(t.message)}m.get().then((function(a){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Firebase Data received");var r=-1,o=e.getAttribute("data-firebase-name")||"",n=e.getAttribute("data-firebase-address")||"",l=e.getAttribute("data-firebase-img")||"",d=e.getAttribute("data-firebase-desc")||"",u=e.getAttribute("data-firebase-subtitle")||"",p=e.getAttribute("data-firebase-badge")||"",s=e.getAttribute("data-firebase-rating")||"",m=e.getAttribute("data-target")||"",g=e.getAttribute("data-firebase-lat")||"",c=e.getAttribute("data-firebase-lng")||"",f=e.getAttribute("data-firebase-lat-lng")||"";g=g||"latitude",c=c||"longitude",thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Looping on Firebase Result"),a.forEach((function(e){r+=1;var i={};(i=e.data()).dataindex=r,i.uid=e.id,i.id=e.id;var a=i[g]||0,h=i[c]||0;if((0==a||0==h)&&f.length>0&&i[f]){var b=i[f].split(",");2==b.length&&(a=b[0],h=b[1])}i.latitude=a,i.longitude=h,i.name=i[o]||"",i.address=i[n]||"",i.img=i[l]||"",i.desc=i[d]||"",i.subtitle=i[u]||"",i.badge=i[p]||"",i.rating=i[s]||0,i.target=m,openStreetMapPlugin.addMarkerAt(t,a,h,i)})),thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Firebase Data Parsing done ["+r+" rows]"),setTimeout((function(){openStreetMapPlugin.hidePreloader()}),300),openStreetMapPlugin.emitEvent("firebaseMapLoadSuccess",$(this),i.length)})).catch((function(t){thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Data Parsing Error ["+t+"]"),e.setAttribute("data-loaded",!1),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("firebaseMapLoadError",$(this),t),openStreetMapPlugin.showAlert("Error getting documents: "+t)}))},showPreloader:function(){"undefined"!=typeof app&&app.preloader.show()},hidePreloader:function(){"undefined"!=typeof app&&app.preloader.hide()},showAlert:function(e){"undefined"!=typeof app&&app.dialog.alert(e)},emitEvent:function(e,t,i,a){i=i||null,a=a||null,"undefined"!=typeof app&&app.emit(e,t,i,a)},getMapInstance:function(e){var t=document.getElementById(e);return t&&t.data?t.data:null},flattenObj:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i))if("object"==typeof e[i]){var a=openStreetMapPlugin.flattenObj(e[i]);for(var r in a)a.hasOwnProperty(r)&&(t[i+"."+r]=a[r])}else t[i]=e[i];return t},loadMarkersFromJsonApi:function(e,t){var i=e.getAttribute("data-json-root")||null,a=e.getAttribute("data-json-source")||null;if(!a){var r="Invalid url for JSON Source";return thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] "+r),void openStreetMapPlugin.showAlert(r)}var o=[],n={},l={},d=!1;n.method="GET",kMode.length>0&&(n.mode=kMode),kCache.length>0&&(n.cache=kCache),kCredentials.length>0&&(n.credentials=kCredentials),kContenttype.length>0&&(l["Content-Type"]=kContenttype,d=!0),kRedirect.length>0&&(l.redirect=kRedirect,d=!0),kReferrerpolicy.length>0&&(l.referrerpolicy=kReferrerpolicy,d=!0),kAuthorization.length>0&&(l.Authorization=kAuthorization,d=!0),1==d&&(n.headers=l);for(var u,p=a,s=/[^{\}]+(?=})/g;u=s.exec(p);){var m=u[0];if(m&&m.length>0){var g="";try{g=window[m]}catch(e){app.preloader.hide();r="[com.thoriumbuilder.jsonapi] Unable to find variable "+m+"] "+e;return void app.dialog.alert(r)}if(!g){app.preloader.hide();r="[com.thoriumbuilder.jsonapi] variable ["+m+"] is undefined";return void app.dialog.alert(r)}a=a.replace("{"+m+"}",encodeURIComponent(g))}}thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] get data from url ["+a+"]"),fetch(a,n).then((function(r){r.text().then((r=>{var n;thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] data succesfully loaded from url ["+a+"]");try{n=JSON.parse(r)}catch(e){return thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Error ["+e.message+"]"),openStreetMapPlugin.emitEvent("jsonDataloadError",$(this)),void openStreetMapPlugin.showAlert(e.message+" "+r)}var l,d=-1,u={};l="object"==typeof n&&i?jsonApiPlugin.getChildrenProperty(n,i):i?n[i]:n;var p=[];for(const[e,t]of Object.entries(l)){var s=openStreetMapPlugin.flattenObj(t);p.push(s)}l=p;var m=e.getAttribute("data-json-maxrows")||9999999;0==m&&(m=9999999);var g=e.getAttribute("data-json-name")||"",c=e.getAttribute("data-json-address")||"",f=e.getAttribute("data-json-img")||"",h=e.getAttribute("data-json-desc")||"",b=e.getAttribute("data-json-subtitle")||"",v=e.getAttribute("data-json-badge")||"",M=e.getAttribute("data-json-rating")||"",S=e.getAttribute("data-target")||"",P=e.getAttribute("data-json-lat")||"",w=e.getAttribute("data-json-lng")||"",A=e.getAttribute("data-json-lat-lng")||"",E=e.getAttribute("data-json-key")||"";if(thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Processing Result Data"),l){var y=openStreetMapPlugin.addMapCluster(t);if(!y){app.preloader.hide();var k="[com.thoriumbuilder.dbexpress.maps] map engine initialization failed, unable to create cluster";return thoriumapi.logEvent(2,k),void app.dialog.alert(k)}for(var O in l){if((d+=1)>=m)break;(u=l[O]).dataindex=d;var L=parseFloat(u[P])||0,T=parseFloat(u[w])||0;if((0==L||0==T)&&A.length>0)if(u[A]){var C=u[A].split(",");2==C.length&&(L=parseFloat(C[0]),T=parseFloat(C[1]))}u.latitude=L,u.longitude=T,u.id=u[E]||"",u.uid=u[E]||"",u.name=u[g]||"",u.address=u[c]||"",u.img=u[f]||"",u.desc=u[h]||"",u.subtitle=u[b]||"",u.badge=u[v]||"",u.rating=u[M]||0,u.target=S,0!=L&&0!=T&&openStreetMapPlugin.addMarkertoClusterAt(y,L,T,u)}openStreetMapPlugin.addClusterToMap(t,y)}openStreetMapPlugin.emitEvent("jsonDataloadSuccess",$(this),t,o)})).catch((function(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Api Error: ["+e.message+"]"),openStreetMapPlugin.showAlert(e.message)}))})).catch((function(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Api Error: ["+e.message+"]"),openStreetMapPlugin.emitEvent("jsonDataloadError",$(this)),openStreetMapPlugin.showAlert(e.message)}))},initMap:function(e){var t=document.getElementById(e);if(!t)return openStreetMapPlugin.hidePreloader(),void thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Open Street Map Object not found");if("true"==t.getAttribute("data-initialized"))return openStreetMapPlugin.hidePreloader(),thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Open Street Map Object with ID ["+e+"] already initialized]"),u=t.data;openStreetMapPlugin.showPreloader(),thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Init Open Street Map with ID: ["+e+"]"),t.style.opacity="0";var i=t.getAttribute("data-geolocation")||"false",a=parseInt(t.getAttribute("data-zoom")||2),r=parseFloat(t.getAttribute("data-lat")||0),o=parseFloat(t.getAttribute("data-lng")||0),n=t.getAttribute("data-tile-layer-url")||null,l=t.getAttribute("data-tile-layer-options")||null,d=t.getAttribute("data-scrollwheelzoom")||null,u=null;if("false"==d){u=L.map(e,{scrollWheelZoom:!1}).setView([r,o],a)}else u=L.map(e).setView([r,o],a);if(openStreetMapPlugin.addtileLayer(u,n,l),1==thoriumapi.isLocal()&&"true"==i&&(i=!1,thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Geolocation is not enabled with the simulator"),thoriumCorePlugin.showToast("Geolocation not allowed with Simulator")),"true"==i)if(navigator.geolocation){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Trying to geoLocate user...");try{u.locate({setView:!0,maxZoom:a}),u.on("locationfound",openStreetMapPlugin.onLocationFound),u.on("locationerror",openStreetMapPlugin.onLocationError)}catch(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Leaflet Geolocation error: "+e)}}else thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Geolocation is not enabled");else setTimeout((function(){u.invalidateSize(),t.style.opacity="1",openStreetMapPlugin.hidePreloader()}),50);var p=L.layerGroup().addTo(u);return u.data=p,t.setAttribute("data-initialized","true"),t.data=u,u.on("click",openStreetMapPlugin.mapOnClick),t.style.opacity=1,openStreetMapPlugin.hidePreloader(),thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Open Street Map Object with ID ["+e+"] successfully initialized]"),openStreetMapPlugin.hidePreloader(),openStreetMapPlugin.emitEvent("osmMapInitialized[#"+t.id+"]",t,u),u},onLocationFound:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Geolocation found");var t=e.accuracy,i=e.target,a=L.icon({iconUrl:"img/map-marker-me.png",iconSize:[30,30]}),r=openStreetMapPlugin.geolocString.replace("{radius}",t);L.marker(e.latlng,{icon:a}).addTo(i).bindPopup(r).openPopup(),L.circle(e.latlng,t).addTo(i),i.panTo(e.latlng);var o=document.getElementById(i._container.id);setTimeout((function(){i.invalidateSize(),o.style.opacity="1",openStreetMapPlugin.hidePreloader()}),500)},onLocationError:function(e){openStreetMapPlugin.hidePreloader(),thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Geolocation error ["+e.message+"]"),openStreetMapPlugin.showAlert(e.message)},addMarkerAt:function(e,t,i,a){if(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Adding Open Street Map Marker at position ["+t+" | "+i+"]");var r=e.data,o="map-marker-icon.png";a.markerimg&&a.markerimg.length>0&&(o=a.markerimg);var n=L.icon({iconUrl:"img/"+o,iconSize:[24,39]});a.icon=n;var l=new L.Marker([t,i],a);return l.on("click",openStreetMapPlugin.markerOnClick).addTo(r),l.on("mouseover",openStreetMapPlugin.markerOnMouseOver).addTo(r),l.on("mouseout",openStreetMapPlugin.markerOnMouseLeave).addTo(r),l}thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] mapObject undefined")},addMapCluster:function(e){return new L.MarkerClusterGroup},addMarkertoClusterAt(e,t,i,a){var r="map-marker-icon.png";a.markerimg&&a.markerimg.length>0&&(r=a.markerimg);var o=L.icon({iconUrl:"img/"+r,iconSize:[24,39]});a.icon=o;var n=new L.Marker([t,i],a);n.on("click",openStreetMapPlugin.markerOnClick).addTo(e),n.on("mouseover",openStreetMapPlugin.markerOnMouseOver).addTo(e),n.on("mouseout",openStreetMapPlugin.markerOnMouseLeave).addTo(e),n.bindTooltip(a.name),e.addLayer(n)},addClusterToMap:function(e,t){e.addLayer(t),thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Cluster added to Map"),openStreetMapPlugin.emitEvent("osmMapClusterAdded",e,t)},setInfoWindow:function(e){var t;thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Set Info Window Content"),t=(t=(t=(t=openStreetMapPlugin.infoWindowHTML).replace(/{name}/g,e.name||"unknown place")).replace(/{uid}/g,e.uid||"")).replace(/{address}/g,e.address||"");var a=!1;e.locimage&&e.locimage.length>0?(e.img=e.locimage,a=!0):e.img&&e.img.length>0?a=!0:e.img="",t=(t=(t=(t=(t=(t=(t=t.replace(/{img}/g,e.img)).replace(/{description}/g,e.desc||"")).replace(/{subtitle}/g,e.subtitle||"")).replace(/{badge}/g,e.badge||"")).replace(/{target}/g,e.target||"")).replace(/{latitude}/g,e.latitude)).replace(/{longitude}/g,e.longitude);var r="";for(i=0;i<e.rating;i++)r+='<i class="f7-icons">star_fill</i>';t=t.replace(/{rating}/g,r||"");var o=e.service||null;if(o){var n=e.pk||null;t=t.replace(/{datablock}/g,"&service="+o+"&pk="+n+"&rowindex=0")}else t=t.replace(/{datablock}/g,"&data="+encodeURIComponent(JSON.stringify(e)));if($(".custominfowindow").html(t),0==a){var l=document.querySelector(".custominfowindow .img-zoom");l&&(l.style.display="none")}if(!e.target||0==e.target.length){var d=document.querySelector(".custominfowindow #osm_btn");d&&(d.style.display="none")}return openStreetMapPlugin.emitEvent("osmShowInfoWindow",e),t},markerOnMouseLeave:function(e){this.closeTooltip(),openStreetMapPlugin.emitEvent("osmMapMarkerMouseLeave",e)},mapOnClick:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Map Click Detected");var t=e.latlng;openStreetMapPlugin.emitEvent("osmMapOnClick",this,t),$(".custominfowindow").hide()},markerOnMouseOver:function(e){if("undefined"==typeof app){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Mouse Over Map Marker");var t=this.options,i=openStreetMapPlugin.setInfoWindow(t);$(".custominfowindow").hide(),e.target.bindPopup(i).openPopup()}else this.openTooltip();openStreetMapPlugin.emitEvent("osmMapMarkerMouseOver",e)},displayInfoWindow:function(e){var t=e.options;if(openStreetMapPlugin.setInfoWindow(t),"undefined"!=typeof app)$(".custominfowindow").show(),$(".custominfowindow").css("height","auto");else if($(".custominfowindow").hide(),t.target&&t.target.length>0){var i=t.target+".html";t.id&&(i=i+"?id="+hash_encode(t.id)),location=i}},markerOnClick:function(e){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Marker Click Detected");var t=this.options;openStreetMapPlugin.displayInfoWindow(this),openStreetMapPlugin.emitEvent("osmMarkerOnClick",e,t),t.target||$("#osm_btn").hide()},addtileLayer:function(e,t,i){if(i=i||"",t=t||null){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] adding Tile Layer from url ["+t+"] with options ["+i+"]");try{L.tileLayer(t,{options:i}).addTo(e)}catch(e){thoriumapi.logEvent(2,"[com.thoriumbuilder.leaflet] Error while adding Title Layer ["+e+"]"),openStreetMapPlugin.showAlert("Error while adding Title Layer "+e)}}else thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] adding default Tile Layer from url [https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png]"),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(e)},setWMSService:function(e,t,i){var a=document.getElementById(e);if(a){var r=a.data;if(r){L.tileLayer.wms(t,{layers:i}).addTo(r);thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] WMS Service ["+t+"] with option ["+i+"] Added to OSM Map with id:"+e),setTimeout((function(){r.invalidateSize()}),100)}}},addGeoJSON:function(e,t){if(t=t||null){var i=document.getElementById(e);if(i){var a=i.data;a&&(L.geoJSON(t).addTo(a),thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Geojson Added to OSM Map with id:"+e),setTimeout((function(){a.invalidateSize()}),500))}}},addCircle:function(e,t,i){if(t=t||null){var a=document.getElementById(e);if(a){var r=a.data;if(r){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Circle Added to OSM Map with id:"+e);L.circle(t,i).addTo(r);setTimeout((function(){r.invalidateSize()}),500)}else thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Add Circle to OSM Map: Undefined Map")}else thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Add Circle to OSM Map: Undefined Map")}else thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Add Circle to OSM Map: Position not set")},addPolygon:function(e,t,i){if(t=t||null){var a=document.getElementById(e);if(a){var r=a.data;if(r){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Polygon Added to OSM Map with id:"+e);L.polygon(t,i).addTo(r);setTimeout((function(){r.invalidateSize()}),500)}else thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Add Polygon to OSM Map: Undefined Map")}else thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Add Polygon to OSM Map: Undefined Map")}else thoriumapi.logEvent(1,"[com.thoriumbuilder.leaflet] Add Polygon to OSM Map: Position not set")},showStaticMarkers:function(e){var t=e.getAttribute("data-markers")||"";e.getAttribute("data-target");if(t.length>0){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Loading Static Markers for Map");var i=Base64.decode(t),a=JSON.parse(i);for(item of a)item.target||(item.target=""),openStreetMapPlugin.addMarkerAt(e.data,item.latitude,item.longitude,item)}},initAllMaps:function(){var e=0;thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Calling initAllMaps function");e=0;var t=document.querySelectorAll(".openstreetmap-api");for(e=0;e<t.length;e++){var i=t[e],a=i.getAttribute("data-initialized")||"false",r=i.getAttribute("data-dbsource")||null,o=null;if(o="false"==a?openStreetMapPlugin.initMap(i.id):i.data){"firebase"==r?(thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Get Markers from Firebase for OSM Map with id:"+i.id),openStreetMapPlugin.getFirebaseData(i,o)):"sqlite"==r||("json"==r?(thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Get Markers from JSON API for OSM Map with id:"+i.id),openStreetMapPlugin.loadMarkersFromJsonApi(i,o)):"static"==r&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Get Markers from Static list for OSM Map with id:"+i.id),openStreetMapPlugin.showStaticMarkers(i)));for(var n=i.querySelectorAll(".leaflet-control-attribution a"),l=0;l<n.length;l++){var d=n[l];d.classList.add("link"),d.classList.add("external"),d.setAttribute("target","_blank")}}}return openStreetMapPlugin.hidePreloader(),e},clearMapLayer:function(e){if(e&&e.length>0){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Clear Map Leyer for OSM Map with id:"+e);var t=document.getElementById(e);if(t){var i=t.data.data;i&&i.clearLayers()}}},reloadAllMaps:function(){thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Reloading All Maps in DOM"),$(".openstreetmap-api").each((function(e,t){openStreetMapPlugin.refreshMap(t.id)}))},refreshMap:function(e){openStreetMapPlugin.showPreloader(),openStreetMapPlugin.clearMapLayer(e);var t=document.getElementById(e);if(t){var i=t.data;if(i){i.data;var a=t.getAttribute("data-dbsource")||null;t.setAttribute("data-loaded","false"),thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Reload Markers from Firebase for OSM Map with id:"+t.id),"firebase"==a?(thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Get Markers from Firebase for OSM Map with id:"+t.id),openStreetMapPlugin.getFirebaseData(t,i)):"json"==a?(thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Get Markers from JSON API for OSM Map with id:"+t.id),openStreetMapPlugin.loadMarkersFromJsonApi(t,t)):"static"==a&&(thoriumapi.logEvent(0,"[com.thoriumbuilder.leaflet] Get Markers from Static list for OSM Map with id:"+t.id),openStreetMapPlugin.showStaticMarkers(t)),openStreetMapPlugin.emitEvent("osmMapReloaded",i)}}},initialize:function(){"undefined"!=typeof app&&app.on("pageMounted",(function(e){setTimeout((function(){openStreetMapPlugin.initAllMaps(),app.preloader.hide()}),100)})),setTimeout((function(){openStreetMapPlugin.initAllMaps(),app.preloader.hide()}),100)}};